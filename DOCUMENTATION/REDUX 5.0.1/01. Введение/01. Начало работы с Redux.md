# Начало работы с Redux

Redux — это контейнер с предсказуемым состоянием для приложений JavaScript.

Это помогает вам писать приложения, которые ведут себя согласованно, работают в различных средах (клиентских, серверных и собственных) и легко тестируются. Кроме того, он предоставляет отличные возможности для разработчиков, такие как [редактирование кода в реальном времени в сочетании с дебаггером](https://github.com/reduxjs/redux-devtools).

Вы можете использовать Redux вместе с [React](https://react.dev/) или с любой другой библиотекой представлений. Он крошечный (2 КБ, включая зависимости), но имеет большую экосистему доступных дополнений.

[Redux Toolkit](https://redux-toolkit.js.org/) — наш официальный рекомендуемый подход для написания логики Redux. Он охватывает ядро Redux и содержит пакеты и функции, которые, по нашему мнению, необходимы для создания приложения Redux. Redux Toolkit использует предложенные нами лучшие практики, упрощает большинство задач Redux, предотвращает распространенные ошибки и упрощает написание приложений Redux.

RTK включает в себя утилиты, которые помогают упростить многие распространенные случаи использования, включая [настройку хранилища](https://redux-toolkit.js.org/api/configureStore), создание [reducer](https://redux-toolkit.js.org/api/createreducer) и написание [неизменяемой логики обновления](https://redux-toolkit.js.org/api/createreducer) и даже одновременное создание целых «фрагментов» (slices) состояния.

Независимо от того, являетесь ли вы новым пользователем Redux, настраивающим свой первый проект, или опытным пользователем, желающим упростить существующее приложение, [Redux Toolkit](https://redux-toolkit.js.org/) поможет вам улучшить ваш код Redux.

## Установка

### Redux Toolkit

Redux Toolkit доступен в виде пакета NPM для использования с сборщиком модулей или в приложении Node:

```bash
# NPM
npm install @reduxjs/toolkit

# Yarn
yarn add @reduxjs/toolkit
```

### Create a React Redux App

Рекомендуемый способ запуска новых приложений с помощью React и Redux — использовать наш официальный [шаблон Redux+TS для Vite](https://github.com/reduxjs/redux-templates) или создать новый проект Next.js с использованием [шаблона Next with-redux](https://github.com/vercel/next.js/tree/canary/examples/with-redux).

Оба из них уже имеют Redux Toolkit и React-Redux, настроенные соответствующим образом для этого инструмента сборки, и поставляются с небольшим примером приложения, которое демонстрирует, как использовать некоторые функции Redux Toolkit.

```bash
# Vite с нашим шаблоном Redux+TS
# (использование инструмента "degit" для клонирования и извлечения шаблона)
npx degit reduxjs/redux-templates/packages/vite-template-redux my-app

# Next.js с использованием шаблона with-redux
npx create-next-app --example with-redux my-app
```

В настоящее время у нас нет официальных шаблонов React Native, но мы рекомендуем эти шаблоны для стандартного React Native и Expo:

- https://github.com/rahsheen/react-native-template-redux-typescript
- https://github.com/rahsheen/expo-template-redux-typescript

### Ядро Redux

Основная библиотека Redux доступна в виде пакета NPM для использования с сборщиком модулей или в приложении Node:

```bash
# NPM
npm install redux

# Yarn
yarn add redux
```

Пакет включает предварительно скомпилированную сборку ESM, которую можно использовать как тег `<script type="module">` непосредственно в браузере.

Более подробную информацию смотрите на странице [Installation](https://redux.js.org/introduction/installation).

## Базовый пример

Все глобальное состояние вашего приложения хранится в дереве объектов внутри одного хранилища. Единственный способ изменить дерево состояний — создать действие action - объект, описывающий произошедшее, и отправить его в хранилище store. Чтобы указать, как состояние обновляется в ответ на действие action, вы пишете чистые функции reducer, которые вычисляют новое состояние на основе старого состояния state и действия action.

Redux Toolkit упрощает процесс написания логики Redux и настройки хранилища. С Redux Toolkit базовая логика приложения выглядит так:

```js
import { createSlice, configureStore } from '@reduxjs/toolkit';

const counterSlice = createSlice({
  name: 'counter',
  initialState: {
    value: 0,
  },
  reducers: {
    incremented: state => {
      // Redux Toolkit позволяет нам писать «мутирующую» логику в reducers. Это
      // фактически не изменяет состояние, поскольку используется библиотека Immer,
      // которая обнаруживает изменения в «черновом состоянии» и создает совершенно новое
      // неизменяемое состояние, основанное на этих изменениях
      state.value += 1;
    },
    decremented: state => {
      state.value -= 1;
    },
  },
});

export const { incremented, decremented } = counterSlice.actions;

const store = configureStore({
  reducer: counterSlice.reducer,
});

// Также можно подписаться на обновление store
store.subscribe(() => console.log(store.getState()));

// Объекты action по-прежнему передаются в диспетчер, но они создаются за нас автоматически.
store.dispatch(incremented()); // {value: 1}
store.dispatch(incremented()); // {value: 2}
store.dispatch(decremented()); // {value: 1}
```

Вместо непосредственного изменения состояния вы указываете мутации, которые должны произойти с простыми объектами, называемыми actions. Затем вы пишете специальную функцию, называемую reducer, чтобы решить, как каждое действие преобразует состояние всего приложения.

В типичном приложении Redux есть только одно хранилище с одной функцией корневого reducer. По мере роста вашего приложения вы разделяете корневой reducer на более мелкие reducer, независимо работающие с разными частями дерева состояний. Это точно так же, как в приложении React есть только один корневой компонент, но он состоит из множества мелких компонентов.

Эта архитектура может показаться слишком сложной для приложения-счетчика, но красота этого шаблона в том, насколько хорошо он масштабируется для больших и сложных приложений. Он также предоставляет очень мощные инструменты разработчика, поскольку можно отследить каждую мутацию до действия action, которое ее вызвало. Вы можете записывать сеансы пользователей и воспроизводить их, просто воспроизводя каждое действие action.

Redux Toolkit позволяет нам писать более короткую логику, которую легче читать, сохраняя при этом то же поведение Redux и поток данных.

### Legacy пример

Для сравнения, исходный устаревший синтаксис Redux (без абстракций) выглядит так:

```js
import { createStore } from 'redux';

/** Это reducer — функция, которая принимает значение текущего состояния и
 * объект действия, описывающий «что произошло» и возвращающий новое значение состояния.
 * Сигнатура функции reducer: (state, action) => newState
 *
 * Состояние Redux должно содержать только простые объекты JS, массивы и примитивы.
 * Значение корневого состояния обычно является объектом. Важно, чтобы вы
 * не мутировать объект состояния, а возвращать новый объект, если состояние изменится.
 *
 * В reducer вы можете использовать любую условную логику. В этом примере
 * мы используем оператор switch, но это не обязательно.
 */
function counterReducer(state = { value: 0 }, action) {
  switch (action.type) {
    case 'counter/incremented':
      return { value: state.value + 1 };
    case 'counter/decremented':
      return { value: state.value - 1 };
    default:
      return state;
  }
}

// Создайте хранилище Redux, хранящее состояние вашего приложения.
// Его API – {subscribe, dispatch, getState}.
let store = createStore(counterReducer);

// Вы можете использовать subscribe() для обновления UI в ответ на изменения состояния.
// Обычно используется библиотека для привязки состояния
// (например, React Redux), а не напрямую метод subscribe().
// Могут быть и другие случаи, когда полезно подписаться.
store.subscribe(() => console.log(store.getState()));

// Единственный способ изменить внутреннее состояние — отправить action.
// Actions можно сериализовать, записать в журнал или сохранить, а затем воспроизвести.
store.dispatch({ type: 'counter/incremented' }); // {value: 1}
store.dispatch({ type: 'counter/incremented' }); // {value: 2}
store.dispatch({ type: 'counter/decremented' }); // {value: 1}
```

## Изучите Redux

У нас есть множество ресурсов, которые помогут вам изучить Redux.

### Руководство по основам Redux

Учебное пособие [Redux Essentials](https://redux.js.org/tutorials/essentials/part-1-overview-concepts) — это руководство «сверху вниз», в котором рассказывается, «как правильно использовать Redux», с использованием наших новейших рекомендуемых API и лучших практик. Мы рекомендуем начать с этого.

### Руководство по фундаментальным основам Redux

Учебное пособие [Redux Fundamentals](https://redux.js.org/tutorials/fundamentals/part-1-overview) — это руководство «снизу вверх», в котором объясняется, «как работает Redux» с первых принципов и без каких-либо абстракций, а также почему существуют стандартные шаблоны использования Redux.

### Стрим по современному Redux

Сопровождающий Redux Mark Erikson появился на шоу «Learn with Jason», чтобы объяснить, как мы рекомендуем использовать Redux сегодня. Шоу включает в себя пример приложения с живым кодом, в котором показано, как использовать Redux Toolkit и хуки React-Redux с Typescript, а также новые API-интерфейсы извлечения данных RTK Query.

Смотрите шоу на странице [Learn Modern Redux](https://www.learnwithjason.dev/let-s-learn-modern-redux). А также на [Youtube](https://www.youtube.com/watch?v=9zySeP5vH9c).

### Дополнительные руководства

- Репозиторий Redux содержит несколько примеров проектов, демонстрирующих различные аспекты использования Redux. Почти все примеры имеют соответствующую песочницу CodeSandbox. Это интерактивная версия кода, с которым вы можете экспериментировать онлайн. Полный список примеров смотрите на странице [«Примеры»](https://redux.js.org/introduction/examples).

- Бесплатная серия видеороликов [«Начало работы с Redux»](https://app.egghead.io/playlists/fundamentals-of-redux-course-from-dan-abramov-bd5cc867) от создателя Redux Dan Abramov и видеокурсы [«Создание приложений React с помощью идиоматического Redux»](https://egghead.io/courses/building-react-applications-with-idiomatic-redux) на Egghead.io.

- Выступление сопровождающего Redux Mark Erikson на конференции [«Основы Redux»](https://blog.isquaredsoftware.com/2018/03/presentation-reactathon-redux-fundamentals/) и слайды семинара [«Фундаментальный Redux»](https://blog.isquaredsoftware.com/2018/06/redux-fundamentals-workshop-slides/).

- Пост Dave Ceddia [«Полное руководство по React Redux для начинающих»](https://daveceddia.com/redux-tutorial/).

### Другие источники

- [«Часто задаваемые вопросы»](https://redux.js.org/faq) по Redux отвечает на многие распространенные вопросы о том, как использовать Redux, а в разделе документации [«Использование Redux»](https://redux.js.org/usage/) содержится информация об обработке производных данных, тестировании, структурировании логики reducer и сокращении шаблонов.

- В серии руководств [«Практика Redux»](https://blog.isquaredsoftware.com/series/practical-redux/) сопровождающего Redux Mark Erikson демонстрируются реальные промежуточные и продвинутые методы работы с React и Redux (также доступны в виде [интерактивного курса на Educative.io](https://www.educative.io/collection/5687753853370368/5707702298738688)).

- В [списке ссылок React/Redux](https://github.com/markerikson/react-redux-links) ссылки разбиты по категориям: reducers и селекторы, управление побочными эффектами, архитектура Redux, передовые методы и многое другое.

- Наше сообщество создало тысячи библиотек, дополнений и инструментов, связанных с Redux. На странице документации [«Экосистема»](https://redux.js.org/introduction/ecosystem) перечислены наши рекомендации, а полный список доступен в [каталоге дополнений Redux](https://github.com/markerikson/redux-ecosystem-links).

## Помощь и обсуждение

Канал [#redux](https://discord.gg/0ZcbPKXt5bZ6au5t) сообщества [Reactiflux Discord](https://www.reactiflux.com/) — это наш официальный ресурс по всем вопросам, связанным с изучением и использованием Redux. Reactiflux — отличное место, где можно потусоваться, задать вопросы и поучиться — присоединяйтесь к нам!

Вы также можете задавать вопросы в [Stack Overflow](https://stackoverflow.com/), используя тег [#redux](https://stackoverflow.com/questions/tagged/redux).

Если у вас есть отчет об ошибке или вам нужно оставить другой отзыв, сообщите о проблеме в [репозитории Github](https://github.com/reduxjs/redux).

## Стоит ли использовать Redux?

Redux — ценный инструмент для организации вашего состояния, но вам также следует подумать, подходит ли он для вашей ситуации. **Не используйте Redux только потому, что кто-то сказал, что вам следует это делать — потратьте некоторое время, чтобы понять потенциальные преимущества и недостатки его использования.**

Вот несколько советов о том, когда имеет смысл использовать Redux:

- У вас есть разумные объемы данных, которые со временем меняются.
- Вам нужен единый источник правды для вашего состояния
- Вы обнаруживаете, что хранить все состояние в компоненте верхнего уровня уже недостаточно.

Дополнительные мысли о том, как следует использовать Redux, см.:

- [Часто задаваемые вопросы по Redux: Когда мне следует использовать Redux?](https://redux.js.org/faq/general#when-should-i-use-redux)
- [Возможно, вам не понадобится Redux](https://medium.com/@dan_abramov/you-might-not-need-redux-be46360cf367)
- [Redux, часть 1 – реализация и намерение](https://blog.isquaredsoftware.com/2017/05/idiomatic-redux-tao-of-redux-part-1/)
- [Redux, часть 2 – Практика и философия](https://blog.isquaredsoftware.com/2017/05/idiomatic-redux-tao-of-redux-part-2/)
- [Часто задаваемые вопросы по Redux](https://redux.js.org/faq)
