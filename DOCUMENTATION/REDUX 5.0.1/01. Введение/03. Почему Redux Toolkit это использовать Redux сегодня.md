# Почему Redux Toolkit это использовать Redux сегодня

## Что такое Redux Toolkit?

[Redux Toolkit](https://redux-toolkit.js.org/) (также известный как «RTK» для краткости) — это наш официальный рекомендуемый подход для написания логики Redux. Пакет `@reduxjs/toolkit` окружает основной пакет `redux` и содержит методы API и общие зависимости, которые, по нашему мнению, необходимы для создания приложения Redux. Redux Toolkit использует предложенные нами лучшие практики, упрощает большинство задач Redux, предотвращает распространенные ошибки и упрощает написание приложений Redux.

**Если вы сегодня пишете какую-либо логику Redux, вам следует использовать Redux Toolkit для написания этого кода!**

RTK включает в себя утилиты, которые помогают упростить многие распространенные случаи использования, включая [настройку хранилища](https://redux-toolkit.js.org/api/configureStore), [создание reducers и написание неизменяемой логики обновления](https://redux-toolkit.js.org/api/createreducer) и даже одновременное [создание целых «фрагментов» (slice) состояния.](https://redux-toolkit.js.org/api/createslice)

Независимо от того, являетесь ли вы новым пользователем Redux, настраивающим свой первый проект, или опытным пользователем, желающим упростить существующее приложение, [Redux Toolkit](https://redux-toolkit.js.org/) поможет вам улучшить ваш код Redux.

---

**Примечание**

См. эти страницы, чтобы узнать, как использовать «современный Redux» с Redux Toolkit:

- Учебник [Redux Essentials](https://redux.js.org/tutorials/essentials/part-1-overview-concepts), в котором рассказывается, «как правильно использовать Redux» с Redux Toolkit для реальных приложений,
- [Redux Fundamentals, часть 8: Современный Redux с Redux Toolkit](https://redux.js.org/tutorials/fundamentals/part-8-modern-redux), в котором показано, как преобразовать legacy примеры из предыдущих разделов руководства в современные эквиваленты Redux Toolkit.
- [Использование Redux: переход на Modern Redux](https://redux.js.org/usage/migrating-to-modern-redux), в котором рассказывается, как перенести различные виды устаревшей логики Redux в современные эквиваленты Redux.

---

## Чем Redux Toolkit отличается от ядра Redux

### Что такое Redux?

Первое, что нужно спросить: «Что такое Redux?»

Redux на самом деле:

- Единственное хранилище, содержащее «глобальное» состояние.
- Отправка действия action с простым объектом в хранилище, когда что-то происходит в приложении.
- Чистые функции reducer, просматривающие эти действия action и возвращающие неизменно обновленное состояние.

Хотя это и не обязательно, [ваш код Redux обычно включает в себя](https://redux.js.org/tutorials/fundamentals/part-7-standard-patterns):

- Action creators, которые генерируют эти объекты action.
- Middleware для включения побочных эффектов
- Функции Thunk, содержащие синхронную или асинхронную логику с побочными эффектами.
- Нормализованное состояние, позволяющее искать элементы по идентификатору.
- Мемоизированные функции выбора с библиотекой Reselect для оптимизации производных данных.
- Расширение Redux DevTools для просмотра истории ваших действий и изменений состояния.
- Типы TypeScript для действий, состояния и других функций

Кроме того, Redux обычно используется с библиотекой React-Redux, чтобы ваши компоненты React могли взаимодействовать с хранилищем Redux.

### Что делает ядро ​​Redux?

Ядро Redux — очень маленькая и намеренно некомпетентная библиотека. Он предоставляет несколько небольших примитивов API:

- `createStore` для создания хранилища Redux
- `combineReducers` для объединения нескольких slice reducers в один более крупный reducer.
- `applyMiddleware` для объединения нескольких middleware в enhancer (усилитель) хранилища
- `compose` для объединения нескольких усилителей хранилища в один усилитель.

Помимо этого, вся остальная логика, связанная с Redux, в вашем приложении должна быть полностью написана вами.

Хорошей новостью является то, что это означает, что Redux можно использовать по-разному. Плохая новость заключается в том, что нет помощников, которые могли бы облегчить написание вашего кода.

Например, функция reducer — это просто функция. До Redux Toolkit вы обычно писали этот reducer с оператором switch и обновлениями вручную. У вас также, вероятно, будут созданные вручную action creators и константы action type:

```js
// Legacy Redux
const ADD_TODO = 'ADD_TODO';
const TODO_TOGGLED = 'TODO_TOGGLED';

export const addTodo = text => ({
  type: ADD_TODO,
  payload: { text, id: nanoid() },
});

export const todoToggled = id => ({
  type: TODO_TOGGLED,
  payload: { id },
});

export const todosReducer = (state = [], action) => {
  switch (action.type) {
    case ADD_TODO:
      return state.concat({
        id: action.payload.id,
        text: action.payload.text,
        completed: false,
      });
    case TODO_TOGGLED:
      return state.map(todo => {
        if (todo.id !== action.payload.id) return todo;

        return {
          ...todo,
          completed: !todo.completed,
        };
      });
    default:
      return state;
  }
};
```

Ни один из этих кодов конкретно не зависит от какого-либо API из базовой библиотеки `redux`. Но нужно написать много кода. Неизменяемые обновления требовали большого количества рукописных спред-операторов для объектов и операций с массивами, и было очень легко допустить ошибки и случайно изменить состояние в процессе (всегда причина N1 ошибок Redux!). Также было обычным, хотя и не строго обязательным, распространение кода одной функции по нескольким файлам, таким как `action/todos.js`, `constants/todos.js` и `reducers/todos.js`.

Кроме того, настройка store обычно требовала ряда шагов для добавления часто используемого middleware, такого как thunks, и включения поддержки расширения Redux DevTools Extension, хотя это стандартные инструменты, используемые почти в каждом приложении Redux.

### Что делает Redux Toolkit?

Хотя эти шаблоны изначально были показаны в документации Redux, они, к сожалению, требуют большого количества очень многословного и повторяющегося кода. Большая часть этого шаблона не обязательна для использования Redux. Вдобавок ко всему, шаблонный код приводит к большему количеству возможностей для ошибок.

**Мы специально создали Redux Toolkit, чтобы исключить «шаблон» из написанной вручную логики Redux, предотвратить распространенные ошибки и предоставить API, которые упрощают стандартные задачи Redux.**

Redux Toolkit начинается с двух ключевых API, которые упрощают наиболее распространенные действия в каждом приложении Redux:

- `configureStore` настраивает хорошо сконфигурированное хранилище Redux с помощью одного вызова функции, включая объединение reducers, добавление middleware Thunk и настройку интеграции Redux DevTools. Его также проще настроить, чем `createStore`, поскольку он принимает именованные параметры.
- `createSlice` позволяет писать reducers, использующие библиотеку Immer, позволяющую записывать неизменяемые обновления с использованием «мутирующего» синтаксиса JS, такого как `state.value = 123`, без необходимости спред-расширения. Он также автоматически генерирует функции action creator для каждого reducer и генерирует строки action type на основе имен вашего reducer. Наконец, он отлично работает с TypeScript.

Это означает, что код, который вы пишете, может быть значительно проще. Например, тот же самый reducer todos может быть таким:

```js
// features/todos/todosSlice.js
import { createSlice } from '@reduxjs/toolkit';

const todosSlice = createSlice({
  name: 'todos',
  initialState: [],
  reducers: {
    todoAdded(state, action) {
      state.push({
        id: action.payload.id,
        text: action.payload.text,
        completed: false,
      });
    },
    todoToggled(state, action) {
      const todo = state.find(todo => todo.id === action.payload);
      todo.completed = !todo.completed;
    },
  },
});

export const { todoAdded, todoToggled } = todosSlice.actions;
export default todosSlice.reducer;
```

Все action creators и action types генерируются автоматически, а код reducer короче и легче для понимания. Также становится гораздо яснее, что на самом деле обновляется в каждом случае.

С помощью `configureStore` настройку store можно упростить до:

```js
// app/store.js
import { configureStore } from '@reduxjs/toolkit';
import todosReducer from '../features/todos/todosSlice';
import filtersReducer from '../features/filters/filtersSlice';

export const store = configureStore({
  reducer: {
    todos: todosReducer,
    filters: filtersReducer,
  },
});
```

Обратите внимание, что **один вызов `configureStore` автоматически выполняет всю обычную работу по настройке, которую вы выполняли бы вручную:**

- slice reducers были автоматически переданы в функцию `combineReducers()`.
- middleware redux-thunk был добавлен автоматически.
- для режима разработки был добавлен middleware для обнаружения случайных мутаций.
- Расширение Redux DevTools было установлено автоматически.
- Усилители middleware и DevTools были составлены вместе и добавлены в store.

В то же время **`configureStore` предоставляет пользователям возможность изменять любое из этих действий по умолчанию** (например, отключение thunks и добавление sagas или отключение DevTools в production).

Redux Toolkit включает в себя другие API для распространенных задач Redux:

- `createAsyncThunk`: абстрагирует стандартный шаблон «отправка в dispatch действия до/после асинхронного запроса».
- `createEntityAdapter`: готовые reducers и селекторы для операций CRUD в нормализованном состоянии.
- `createSelector`: повторный экспорт стандартного API Reselect для запоминаемых селекторов.
- `createListenerMiddleware`: middleware с побочными эффектами для запуска логики в ответ на отправленные в dispatch actions.

Наконец, пакет RTK также включает «RTK Query», полное решение для извлечения и кэширования данных для приложений Redux, в качестве отдельной дополнительной точки входа `@reduxjs/toolkit/query`. Он позволяет вам определять конечные точки (REST, GraphQL или любую асинхронную функцию) и генерирует reducer и middleware, которые полностью управляют получением данных, обновлением состояния загрузки и кэшированием результатов. Он также автоматически генерирует хуки React, которые можно использовать в компонентах для получения данных, например `const { data, isFetching } = useGetPokemonQuery('pikachu')`

Каждый из этих API является совершенно необязательным и предназначен для конкретных случаев использования, и **вы можете выбирать, какие API вы действительно используете в своем приложении.** Но всем они рекомендуются для помощи с этими задачами.

Обратите внимание, что **Redux Toolkit по-прежнему остается «Redux»**! По-прежнему существует одно хранилище с отправляемыми объектами действий для обновлений и reducers, которые неизменно обновляют состояние, а также возможностью писать преобразователи для асинхронной логики, управлять нормализованным состоянием, печатать код с помощью TypeScript и использовать DevTools. **Для достижения тех же результатов вам придется написать гораздо меньше кода!**

## Почему мы хотим, чтобы вы использовали Redux Toolkit

Наше мнение, как сопровождающих Redux, следующее:

Мы хотим, чтобы все пользователи Redux писали свой код Redux с помощью Redux Toolkit, потому что это упрощает ваш код и устраняет многие распространенные ошибки и ошибки Redux!

«Шаблон» и сложность ранних шаблонов Redux никогда не были необходимой частью Redux. Эти шаблоны существовали только потому, что:

- Оригинальная «Архитектура потока» использовала некоторые из тех же подходов.
- В ранней документации Redux были показаны такие вещи, как константы типов действий, позволяющие разделить код на разные файлы по типу.
- По умолчанию JavaScript является изменяемым языком, и для написания неизменяемых обновлений необходимо вручную добавлять спред-операторы объектов и обновлять массивы.
- Redux изначально был создан всего за несколько недель и намеренно представлял собой всего лишь несколько примитивов API.

Кроме того, сообщество Redux приняло некоторые конкретные подходы, которые добавляют дополнительный шаблон:

- Акцент на использовании middleware `redux-saga` как общего подхода к написанию побочных эффектов.
- Настаивая на написании типов TS для объектов действий Redux и создании типов union, чтобы ограничить, какие действия могут быть отправлены на уровне типа.

За прошедшие годы мы увидели, как люди на самом деле использовали Redux на практике. Мы видели, как сообщество написало сотни дополнительных библиотек для таких задач, как создание типов действий и создание actions, асинхронная логика и побочные эффекты, а также получение данных. Мы также видели проблемы, которые постоянно причиняли боль нашим пользователям, например, случайное изменение состояния, написание десятков строк кода только для одного простого обновления состояния и проблемы с отслеживанием того, как кодовая база согласуется друг с другом. Мы помогли тысячам пользователей, которые пытались изучить и использовать Redux, пытались понять, как все его части сочетаются друг с другом, и были сбиты с толку количеством концепций и объемом дополнительного кода, который им приходилось писать. Мы знаем, с какими проблемами сталкиваются наши пользователи.

**Мы специально разработали Redux Toolkit для решения этих проблем!**

- Redux Toolkit упрощает настройку store до одного четкого вызова функции, сохраняя при этом возможность полной настройки параметров store, если вам нужно.
- Redux Toolkit устраняет случайные мутации, которые всегда были причиной ошибок Redux N1.
- Redux Toolkit устраняет необходимость вручную писать action creators или action types.
- Redux Toolkit устраняет необходимость написания вручную и подверженной ошибкам неизменяемой логики обновления.
- Redux Toolkit позволяет легко писать код функции Redux в одном файле, вместо того, чтобы распределять его по нескольким отдельным файлам.
- Redux Toolkit предлагает отличную поддержку TS с API-интерфейсами, разработанными для обеспечения превосходной безопасности типов и минимизации количества типов, которые вам необходимо определить в вашем коде.
- RTK Query может устранить необходимость написания каких-либо thunks, reducers, action creators или хуков для управления получением данных и отслеживанием состояния загрузки.

Из-за этого:

Мы особенно рекомендуем нашим пользователям использовать Redux Toolkit (пакет `@reduxjs/toolkit`) и не использовать устаревший основной пакет `redux` для любого нового кода Redux сегодня!

Даже для существующих приложений мы рекомендуем, по крайней мере, отключить `createStore` для `configureStore`, поскольку middleware режима разработки также поможет вам обнаружить случайные ошибки мутации и сериализации в существующих базах кода. Мы также хотим призвать вас переключить reducers, которые вы используете чаще всего (и те, которые вы напишете в будущем), на `createSlice` — код станет короче и легче для понимания, а улучшения безопасности сэкономят вам время и усилия в будущем.

**Базовый пакет `redux` все еще работает, но на сегодняшний день мы считаем его устаревшим.** Все его API также реэкспортируются из `@reduxjs/toolkit`, а `configureStore` делает то же, что и `createStore`, но с лучшим поведением по умолчанию и улучшенными возможностями настройки.

Полезно понять концепции нижнего уровня, чтобы лучше понять, что Redux Toolkit делает для вас. Вот почему руководство [«Фундаментальный Redux» показывает, как работает Redux, без каких-либо абстракций](https://redux.js.org/tutorials/fundamentals/part-1-overview). Но эти примеры показаны исключительно в качестве инструмента обучения, а в конце показано, как Redux Toolkit упрощает старый рукописный код Redux.

Если вы используете основной пакет `redux` отдельно, ваш код продолжит работать. **Но мы настоятельно рекомендуем вам перейти на `@reduxjs/toolkit` и обновить свой код, чтобы вместо этого использовать API-интерфейсы Redux Toolkit!**

## Дополнительная информация

Дополнительные сведения см. на страницах документации и в сообщениях блога.

- [Основы Redux: структура приложения Redux Toolkit](https://redux.js.org/tutorials/essentials/part-2-app-structure)
- [Фундаментальный Redux: современный Redux с Redux Toolkit](https://redux.js.org/tutorials/fundamentals/part-8-modern-redux)
- [Руководство по стилю Redux: лучшие практики и рекомендации](https://redux.js.org/style-guide/)
- [Презентация: Современный Redux с Redux Toolkit](https://blog.isquaredsoftware.com/2022/06/presentations-modern-redux-rtk/)
- [Mark Erikson: Анонс Redux Toolkit 1.0 и история разработки](https://blog.isquaredsoftware.com/2019/10/redux-toolkit-1.0/)
